<%= hidden_field_tag :page_file_name, File.basename(__FILE__) %>

<p id="notice"><%= notice %></p>

<p>
  <strong>タイトル:</strong><br>
  <%= @task_info.title %><br>

  <strong>詳細:</strong><br>
  <%= @task_info.detail %><br>
</p>

<% task_status_change_url = "task_status_change" %>
<!-- タスク開始ボタン -->
<%= form_tag(task_status_change_url, :method => 'get') do %>
	<div class="actions">
	  <%= hidden_field_tag :id, @task_info.id, { :id => "task_start_button_task_id" } -%>
	  <%= hidden_field_tag :task_status_id, TaskStatus.task_status_start.id %>
	  <%= submit_tag "タスク開始", { :id => "task_start_button" } %>
	</div>
<% end %>

<!-- タスク完了ボタン -->
<%= form_tag(task_status_change_url, :method => 'get') do %>
	<div class="actions">
	  <%= hidden_field_tag :id, @task_info.id, { :id => "task_finish_button_task_id" } -%>
	  <%= hidden_field_tag :task_status_id, TaskStatus.task_status_finish.id %>
	  <%= submit_tag "タスク完了", { :id => "task_finish_button" } %>
	</div>
<% end %>

<%
   task_info_log_width = 120
%>

<!-- 新規作業メモ追加欄 -->
<% task_info_log = TaskInfoLog.new(:task_info_id => @task_info.id) %>
<%= form_for(task_info_log, :url => task_info_logs_path(task_info_log)) do |f| %>
	<div class="field">
	  <%= f.hidden_field :task_info_id %>
	  <%= f.label :content, "作業メモ" %><br>
	  <%= f.text_area :content, { :id => "task_info_log_content", :size => "#{task_info_log_width.to_s}x4", :maxlength => 200 } %><br>
	</div>
	<div class="actions">
	  <%= f.submit "作業メモ追加", { :id => "create_task_info_log_button" } %>
	</div>
<% end %>

<br>
<br>

<!-- 作業メモ表示 -->
<% task_info_logs = TaskInfoLog.where(:task_info_id => @task_info.id).order("created_at DESC") %>
<% task_info_logs.each do |task_info_log| %>
	<% row = (task_info_log.content.length*1.5 / task_info_log_width).to_i + 4 # 少し余計にバッファとっておく %>
	<%
	   text = task_info_log.content
	%>
	<%= text_area_tag task_info_log, text, { :id => "show_task_info_log", :size => "#{task_info_log_width.to_s}x#{row.to_s}", :maxlength => 200 } %><br>
	<div style='color:#777777'>作成:<%= task_info_log.created_at %> 更新:<%= task_info_log.updated_at %></div><br>
<% end %>

<%= link_to 'Edit', edit_task_info_path(@task_info) %> |
<%= link_to 'Back', task_infos_path %>
